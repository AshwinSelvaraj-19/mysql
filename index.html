<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>index</title>
  <style>
    #secret-btn {
      position: fixed;
      top: 0;
      left: 0;
      width: 40px;
      height: 40px;
      opacity: 0;
      background: transparent;
      border: none;
      z-index: 9999;
    }
  
    #secret-btn:hover { outline: 1px dashed rgba(0,255,0,0.08); }

    #admin-overlay {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0,0,0,0.6);
      z-index: 10000;
      font-family: system-ui, Arial, sans-serif;
    }
    #admin-panel {
      width: min(900px, 96%);
      max-height: 86%;
      overflow: auto;
      background: #fff;
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
    }
    #admin-panel h2 { margin: 0 0 10px 0; font-size: 18px; }
    #admin-panel pre {
      background: #f6f7fb;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      white-space: pre-wrap;
      word-break: break-word;
    }
    #admin-close {
      display: inline-block;
      margin-top: 12px;
      padding: 8px 12px;
      border-radius: 8px;
      background: #111;
      color: #fff;
      text-decoration: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  
  <button id="secret-btn" aria-label="hidden copy trigger" title="hidden"></button>

  <div id="admin-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div id="admin-panel">
      <h2>Hidden Copy Audit Log</h2>
      <div id="audit-container"><pre id="audit-pre">No logs.</pre></div>
      <button id="admin-close">Close</button>
    </div>
  </div>

  <script>
    (function () {
      const btn = document.getElementById('secret-btn');
      const ADMIN_PASSPHRASE = 'admin123'; // change this for your environment
      const AUDIT_KEY = 'hiddenCopyAudit';

  function auditLog(entryObj) {
        try {
          const existing = JSON.parse(localStorage.getItem(AUDIT_KEY) || '[]');
          existing.push({ ts: new Date().toISOString(), ...entryObj });
          localStorage.setItem(AUDIT_KEY, JSON.stringify(existing));
        } catch (e) {
          // swallow errors silently (no console output)
        }
      }

      async function performCopy() {
        try {
          const resp = await fetch('untitled.txt', { cache: 'no-store' });
          if (!resp.ok) throw new Error('File not found: ' + resp.status);
          const text = await resp.text();
          await navigator.clipboard.writeText(text);
          auditLog({ action: 'copy-success', file: 'untitled.txt', length: text.length });
        } catch (err) {
          auditLog({ action: 'copy-failed', reason: String(err) });
        }
      }

      btn.addEventListener('click', () => {
        // user gesture triggers the copy flow
        performCopy();
      });

      // Admin overlay logic â€” accessible via Ctrl+Shift+A
      const overlay = document.getElementById('admin-overlay');
      const auditPre = document.getElementById('audit-pre');
      const adminClose = document.getElementById('admin-close');

      function openAdminOverlay() {
        // prompt for passphrase (simple demo). Replace with secure auth in prod.
        const pass = prompt('Enter admin passphrase to view audit logs:');
        if (!pass) return;
        if (pass !== ADMIN_PASSPHRASE) {
          alert('Incorrect passphrase');
          return;
        }
        const logs = JSON.parse(localStorage.getItem(AUDIT_KEY) || '[]');
        auditPre.textContent = logs.length ? JSON.stringify(logs, null, 2) : 'No logs.';
        overlay.style.display = 'flex';
        overlay.setAttribute('aria-hidden', 'false');
      }

      adminClose.addEventListener('click', () => {
        overlay.style.display = 'none';
        overlay.setAttribute('aria-hidden', 'true');
      });

      // Keyboard shortcut: Ctrl+Shift+A opens admin overlay
      window.addEventListener('keydown', (ev) => {
        if (ev.ctrlKey && ev.shiftKey && ev.code === 'KeyA') {
          ev.preventDefault();
          openAdminOverlay();
        }
      });

    
      window.getHiddenCopyAudit = function () {
        try {
          return JSON.parse(localStorage.getItem(AUDIT_KEY) || '[]');
        } catch (e) { return []; }
      };
    })();
  </script>
</body>
</html>


